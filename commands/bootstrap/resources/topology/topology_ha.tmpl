tosca_definitions_version: alien_dsl_2_0_0

metadata:
  template_name: YorcHa
  template_version: 0.1.0-SNAPSHOT
  template_author: Yorc

description: ""

imports:
  - alien-base-types/{{getAlien4CloudVersionFromTOSCATypes}}/alien-base-types.yml
  - org.ystia.nfs.linux.ansible/{{getForgeVersionFromTOSCATypes}}/types.yaml
  - <normative-types.yml>
  - org.alien4cloud.alien4cloud.config.location/{{getAlien4CloudVersionFromTOSCATypes}}/types.yml
  - <yorc-google-types.yml>
  - <yorc-openstack-types.yml>
  - <yorc-aws-types.yml>
  - <yorc-hostspool-types.yml>
  - org.ystia.yorc.experimental.consul.linux.ansible/{{getForgeVersionFromTOSCATypes}}/types.yaml
  - org.alien4cloud.elasticsearch.pub/{{getAlien4CloudVersionFromTOSCATypes}}/types.yml
  - org.ystia.terraform.linux.terraform/{{getForgeVersionFromTOSCATypes}}/types.yaml
  - org.alien4cloud.java.jmx.jolokia/{{getAlien4CloudVersionFromTOSCATypes}}/types.yml
  - org.alien4cloud.consul.pub/{{getAlien4CloudVersionFromTOSCATypes}}/types.yml
  - org.ystia.yorc.linux.ansible/{{getForgeVersionFromTOSCATypes}}/types.yaml
  - org.ystia.nfs.pub/{{getForgeVersionFromTOSCATypes}}/types.yaml
  - <yorc-types.yml>
  - org.alien4cloud.java.pub/{{getAlien4CloudVersionFromTOSCATypes}}/types.yml
  - org.ystia.yorc.pub/{{getForgeVersionFromTOSCATypes}}/types.yaml
  - org.alien4cloud.alien4cloud.config.location_resources.on_demand/{{getAlien4CloudVersionFromTOSCATypes}}/types.yml
  - org.alien4cloud.alien4cloud.config.location_resources.autoconfig/{{getAlien4CloudVersionFromTOSCATypes}}/types.yml
  - org.ystia.yorc.experimental.consul.pub/{{getForgeVersionFromTOSCATypes}}/types.yaml
  - org.ystia.ansible.linux.ansible/{{getForgeVersionFromTOSCATypes}}/types.yaml
  - org.alien4cloud.alien4cloud.pub/{{getAlien4CloudVersionFromTOSCATypes}}/types.yml
  - org.alien4cloud.alien4cloud.webapp/{{getAlien4CloudVersionFromTOSCATypes}}/types.yml
  - org.ystia.yorc.alien4cloud/{{getForgeVersionFromTOSCATypes}}/types.yaml
  - org.alien4cloud.java.jdk.linux/{{getAlien4CloudVersionFromTOSCATypes}}/types.yml
  - org.alien4cloud.alien4cloud.config.pub/{{getAlien4CloudVersionFromTOSCATypes}}/types.yml
  - org.alien4cloud.cloudify.hostpool.pub/{{getAlien4CloudVersionFromTOSCATypes}}/types.yml
  - alien-extended-storage-types/{{getAlien4CloudVersionFromTOSCATypes}}/alien-extended-storage-types.yml
  - org.ystia.terraform.pub/{{getForgeVersionFromTOSCATypes}}/types.yaml
  - org.ystia.ansible.pub/{{getForgeVersionFromTOSCATypes}}/types.yaml

topology_template:
  node_templates:
    ConsulServer:
      type: org.ystia.yorc.experimental.consul.linux.ansible.nodes.ConsulServer
      properties:
        install_dnsmasq: true
        mode: server
        tls_enabled: false
        download_url: "{{.Consul.DownloadURL}}"
        install_dir: "/usr/local/bin"
        config_dir: "/etc/consul.d"
        datacenter: dc1
        domain: consul
        web_ui: false
        data_dir: "/var/consul"
      requirements:
        - hostedOnComputeConsulHost:
            type_requirement: host
            node: ConsulCompute
            capability: tosca.capabilities.Container
            relationship: tosca.relationships.HostedOn
      capabilities:
        consul_agent:
          properties:
            port: {{.Consul.Port}}
            protocol: tcp
            secure: false
            network_name: PRIVATE
            initiator: source
    AnsibleRuntime:
      type: org.ystia.ansible.linux.ansible.nodes.AnsibleRuntime
      properties:
        component_version: "{{.Ansible.Version}}"
      requirements:
        - hostedOnComputeYorcHost:
            type_requirement: host
            node: YorcCompute
            capability: tosca.capabilities.Container
            relationship: tosca.relationships.HostedOn
    OracleJDK:
      type: org.alien4cloud.java.jdk.linux.nodes.OracleJDK
      properties:
        java_url: "{{.Jdk.DownloadURL}}"
        java_home: "/opt/java"
        component_version: "{{.Jdk.Version}}"
      requirements:
        - hostedOnAlien4CloudComputeHost:
            type_requirement: host
            node: Alien4CloudCompute
            capability: tosca.capabilities.Container
            relationship: tosca.relationships.HostedOn
    Alien4Cloud:
      type: org.alien4cloud.alien4cloud.webapp.nodes.Alien4Cloud
      properties:
        context_root: "/"
        component_version: "{{getAlien4CloudVersion .Alien4cloud.DownloadURL}}"
        data_dir: "/opt/alien4cloud/data"
      requirements:
        - javaSoftwareHostedOnJdkOracleJdkJdk:
            type_requirement: java
            node: OracleJDK
            capability: org.alien4cloud.java.pub.capabilities.JDK
            relationship: org.alien4cloud.java.pub.relationships.JavaSoftwareHostedOnJDK
      capabilities:
        consul:
          properties:
            tls_enabled: false
            protocol: tcp
            secure: false
            network_name: PRIVATE
            initiator: source
        jolokia:
          properties:
            port: 8778
        http:
          properties:
            port: 9200
            protocol: http
            secure: false
            network_name: PRIVATE
            initiator: source
        rest:
          properties:
            user: {{.Alien4cloud.User}}
            password: {{.Alien4cloud.Password}}
            port: {{.Alien4cloud.Port}}
            protocol: http
            secure: false
            network_name: PRIVATE
            initiator: source
      artifacts:
        alien_dist:
          file: alien4cloud-dist.tar.gz
          type: tosca.artifacts.File
    YorcPlugin:
      type: org.ystia.yorc.alien4cloud.nodes.YorcPlugin
      properties:
        download_url: "{{.YorcPlugin.DownloadURL}}"
        name: Yorc
        discriminator: yorc
        pluginId: "alien4cloud-yorc-plugin"
        pluginBean: "yorc-orchestrator-factory"
        yorc_address_ha: "yorc.service.consul"
      requirements:
        - connectsToYorcYorcServerRest:
            type_requirement: yorc
            node: YorcServer
            capability: org.ystia.yorc.pub.capabilities.YorcRestAPI
            relationship: org.ystia.yorc.alien4cloud.relationships.ConnectsToYorc
        - alienConfiguratorHostedOnAlienAlien4CloudConfig:
            type_requirement: host
            node: Alien4Cloud
            capability: org.alien4cloud.alien4cloud.pub.capabilities.AlienConfigContainer
            relationship: org.alien4cloud.alien4cloud.pub.relationships.AlienConfiguratorHostedOnAlien
    YorcOnDemandLocationResources:
      type: org.ystia.yorc.alien4cloud.nodes.YorcOnDemandLocationResourcesConfigurator
      properties:
        type: "{{.Location.Type}}"
        name: "{{.Location.Name}}"
      requirements:
        - locationHostedOnOrchestratorYorcPluginLocation_config:
            type_requirement: orchestrator
            node: YorcPlugin
            capability: org.alien4cloud.alien4cloud.config.pub.capabilities.OrchestratorConfigurator
            relationship: org.alien4cloud.alien4cloud.config.pub.relationships.LocationHostedOnOrchestrator
      artifacts:
        resources_file_artifact:
          file: {{.Location.ResourcesFile}}
    NFSServer:
      type: org.ystia.nfs.linux.ansible.nodes.NFSServer
      requirements:
        - hostedOnComputeNfsHost:
            type_requirement: host
            node: NFSCompute
            capability: tosca.capabilities.Container
            relationship: tosca.relationships.HostedOn
      capabilities:
        nfs_server:
          properties:
            protocol: tcp
            secure: false
            network_name: PRIVATE
            initiator: source
    TerraformRuntime:
      type: org.ystia.terraform.linux.terraform.nodes.TerraformRuntime
      properties:
        install_dir: "/usr/local/bin"
        plugins_dir: "/var/terraform/plugins"{{formatAsYAML .Terraform 8}}
      requirements:
        - hostedOnComputeYorcHost:
            type_requirement: host
            node: YorcCompute
            capability: tosca.capabilities.Container
            relationship: tosca.relationships.HostedOn
    NFSClient:
      type: org.ystia.nfs.linux.ansible.nodes.NFSClient
      properties:
        fs_type: ext4
        location: "/var/yorc/work"
      requirements:
        - joinNfsServerNfsServerNfs_server:
            type_requirement: partition
            node: NFSServer
            capability: org.ystia.nfs.pub.capabilities.NFSServer
            relationship: org.ystia.nfs.linux.ansible.relationships.JoinNFSServer
        - hostedOnComputeYorcHost:
            type_requirement: host
            node: YorcCompute
            capability: tosca.capabilities.Container
            relationship: tosca.relationships.HostedOn
    ConsulAgentA4C:
      type: org.ystia.yorc.experimental.consul.linux.ansible.nodes.ConsulAgent
      properties:
        install_dnsmasq: true
        mode: agent
        tls_enabled: false
        download_url: "{{.Consul.DownloadURL}}"
        install_dir: "/usr/local/bin"
        config_dir: "/etc/consul.d"
        datacenter: dc1
        domain: consul
        web_ui: false
        data_dir: "/var/consul"
      requirements:
        - joinServerConsulServerConsul_server:
            type_requirement: consul_server
            node: ConsulServer
            capability: org.ystia.yorc.experimental.consul.pub.capabilities.ConsulServer
            relationship: org.ystia.yorc.experimental.consul.linux.ansible.relationships.JoinServer
        - hostedOnAlien4CloudComputeHost:
            type_requirement: host
            node: Alien4CloudCompute
            capability: tosca.capabilities.Container
            relationship: tosca.relationships.HostedOn
      capabilities:
        consul_agent:
          properties:
            port: {{.Consul.Port}}
            protocol: tcp
            secure: false
            network_name: PRIVATE
            initiator: source
    ConsulAgentYorcServer:
      type: org.ystia.yorc.experimental.consul.linux.ansible.nodes.ConsulAgent
      properties:
        install_dnsmasq: true
        mode: agent
        tls_enabled: false
        download_url: "{{.Consul.DownloadURL}}"
        install_dir: "/usr/local/bin"
        config_dir: "/etc/consul.d"
        datacenter: dc1
        domain: consul
        web_ui: false
        data_dir: "/var/consul"
      requirements:
        - joinServerConsulServerConsul_server:
            type_requirement: consul_server
            node: ConsulServer
            capability: org.ystia.yorc.experimental.consul.pub.capabilities.ConsulServer
            relationship: org.ystia.yorc.experimental.consul.linux.ansible.relationships.JoinServer
        - hostedOnComputeYorcHost:
            type_requirement: host
            node: YorcCompute
            capability: tosca.capabilities.Container
            relationship: tosca.relationships.HostedOn
      capabilities:
        consul_agent:
          properties:
            port: {{.Consul.Port}}
            protocol: tcp
            secure: false
            network_name: PRIVATE
            initiator: source
    YorcServer:
      type: org.ystia.yorc.linux.ansible.nodes.YorcServer
      properties:
        download_url: "{{.Yorc.DownloadURL}}"
        install_dir: "/usr/local/bin"
        config_dir: "/etc/yorc"
        data_dir: "{{.Yorc.DataDir}}"
        private_key_content: |{{indent .Yorc.PrivateKeyContent 10}}
      requirements:
        - hostedOnComputeYorcHost:
            type_requirement: host
            node: YorcCompute
            capability: tosca.capabilities.Container
            relationship: tosca.relationships.HostedOn
        - joinConsulAgentConsulAgentConsul_agent:
            type_requirement: consul
            node: ConsulAgentYorcServer
            capability: org.alien4cloud.consul.pub.capabilities.ConsulAgent
            relationship: org.ystia.yorc.linux.ansible.relationships.JoinConsulAgent
        - dependsOnAnsibleRuntimeAnsibleRuntimeFeature:
            type_requirement: ansible
            node: AnsibleRuntime
            capability: tosca.capabilities.Node
            relationship: org.ystia.ansible.pub.relationships.DependsOnAnsibleRuntime
        - dependsOnTerraformRuntimeTerraformRuntimeFeature:
            type_requirement: terraform
            node: TerraformRuntime
            capability: tosca.capabilities.Node
            relationship: org.ystia.yorc.linux.ansible.relationships.DependsOnTerraformRuntime
        - dependsOnFilessystemNfsClientFeature:
            type_requirement: work_directory
            node: NFSClient
            capability: tosca.capabilities.Node
            relationship: org.ystia.yorc.pub.relationships.DependsOnFilessystem
      capabilities:
        rest:
          properties:
            port: {{.Yorc.Port}}
            protocol: http
            secure: false
            network_name: PRIVATE
            initiator: source
    {{if not .Address}}
    Alien4CloudCompute: {{block "Compute" .}} {{end}}
    {{else}}
    Alien4CloudCompute: {{block "ComputeWithAddress" .}} {{end}}
    ComputeAddress:  {{block "ComputeAddress" .}} {{end}}
    {{end}}
    YorcCompute: {{block "ComputeScalable" .}} {{end}}
    ConsulCompute: {{block "ComputeScalable" .}} {{end}}
    NFSCompute: {{block "Compute" .}} {{end}}
    Infrastructure: {{block "Infrastructure" .}} {{end}}
  outputs:
    Alien4Cloud_alien_url:
      value: { get_attribute: [ Alien4Cloud, alien_url ] }
  workflows:
    install:
      steps:
        ConsulAgentYorcServer_start:
          target: ConsulAgentYorcServer
          activities:
            - call_operation: Standard.start
          on_success:
            - ConsulAgentYorcServer_started
        {{if .Address}}
        ComputeAddress_install:
          target: ComputeAddress
          activities:
            - delegate: install
          on_success:
            - Alien4CloudCompute_install
        {{end}}
        ComputeAddress_install:
          target: ComputeAddress
          activities:
            - delegate: install
          on_success:
            - Alien4CloudCompute_install
        OracleJDK_creating:
          target: OracleJDK
          activities:
            - set_state: creating
          on_success:
            - OracleJDK_create
        YorcServer_dependsOnTerraformRuntimeTerraformRuntimeFeature_post_configure_source:
          target: YorcServer
          target_relationship: dependsOnTerraformRuntimeTerraformRuntimeFeature
          operation_host: SOURCE
          activities:
            - call_operation: Configure.post_configure_source
          on_success:
            - Infrastructure_yorcConfigInfrastructureHostedOnYorcYorcServerConfig_post_configure_target
        ComputeYorc_install:
          target: YorcCompute
          activities:
            - delegate: install
          on_success:
            - ConsulAgentYorcServer_initial
            - NFSClient_initial
            - YorcServer_initial
        ConsulAgentA4C_configured:
          target: ConsulAgentA4C
          activities:
            - set_state: configured
          on_success:
            - ConsulAgentA4C_starting
        ConsulServer_create:
          target: ConsulServer
          activities:
            - call_operation: Standard.create
          on_success:
            - ConsulServer_created
        AnsibleRuntime_configuring:
          target: AnsibleRuntime
          activities:
            - set_state: configuring
          on_success:
            - AnsibleRuntime_configured
        YorcServer_created:
          target: YorcServer
          activities:
            - set_state: created
          on_success:
            - YorcServer_configuring
        YorcPlugin_configuring:
          target: YorcPlugin
          activities:
            - set_state: configuring
          on_success:
            - YorcPlugin_connectsToYorcYorcServerRest_pre_configure_source
        NFSClient_initial:
          target: NFSClient
          activities:
            - set_state: initial
          on_success:
            - NFSClient_creating
        ConsulServer_starting:
          target: ConsulServer
          activities:
            - set_state: starting
          on_success:
            - ConsulServer_start
        NFSServer_starting:
          target: NFSServer
          activities:
            - set_state: starting
          on_success:
            - NFSServer_started
        ConsulAgentA4C_starting:
          target: ConsulAgentA4C
          activities:
            - set_state: starting
          on_success:
            - ConsulAgentA4C_start
        NFSClient_created:
          target: NFSClient
          activities:
            - set_state: created
          on_success:
            - NFSClient_configuring
        ConsulServer_created:
          target: ConsulServer
          activities:
            - set_state: created
          on_success:
            - ConsulServer_configuring
        Infrastructure_starting:
          target: Infrastructure
          activities:
            - set_state: starting
          on_success:
        {{if not .Hosts}}
            - Infrastructure_started
        {{else}}
            - Infrastructure_start
		    {{end}}
        {{if .Hosts}}
        Infrastructure_start:
          target: Infrastructure
          activities:
            - call_operation: Standard.start
          on_success:
            - Infrastructure_started
		    {{end}}
        ConsulAgentYorcServer_starting:
          target: ConsulAgentYorcServer
          activities:
            - set_state: starting
          on_success:
            - ConsulAgentYorcServer_start
        NFSServer_configured:
          target: NFSServer
          activities:
            - set_state: configured
          on_success:
            - NFSServer_starting
        ConsulAgentYorcServer_create:
          target: ConsulAgentYorcServer
          activities:
            - call_operation: Standard.create
          on_success:
            - ConsulAgentYorcServer_created
        ConsulServer_configured:
          target: ConsulServer
          activities:
            - set_state: configured
          on_success:
            - ConsulServer_starting
        NFSServer_created:
          target: NFSServer
          activities:
            - set_state: created
          on_success:
            - NFSServer_configuring
        Alien4Cloud_configuring:
          target: Alien4Cloud
          activities:
            - set_state: configuring
          on_success:
            - Alien4Cloud_configure
        NFSClient_starting:
          target: NFSClient
          activities:
            - set_state: starting
          on_success:
            - NFSClient_start
        ConsulAgentA4C_start:
          target: ConsulAgentA4C
          activities:
            - call_operation: Standard.start
          on_success:
            - ConsulAgentA4C_started
        ComputeNFS_install:
          target: NFSCompute
          activities:
            - delegate: install
          on_success:
            - NFSServer_initial
        YorcServer_started:
          target: YorcServer
          activities:
            - set_state: started
          on_success:
            - Infrastructure_initial
            - YorcPlugin_initial
        YorcServer_initial:
          target: YorcServer
          activities:
            - set_state: initial
          on_success:
            - YorcServer_creating
        ConsulAgentA4C_create:
          target: ConsulAgentA4C
          activities:
            - call_operation: Standard.create
          on_success:
            - ConsulAgentA4C_created
        YorcOnDemandLocationResources_create:
          target: YorcOnDemandLocationResources
          activities:
            - call_operation: Standard.create
          on_success:
            - YorcOnDemandLocationResources_created
        Alien4Cloud_started:
          target: Alien4Cloud
          activities:
            - set_state: started
          on_success:
            - YorcPlugin_initial
        OracleJDK_starting:
          target: OracleJDK
          activities:
            - set_state: starting
          on_success:
            - OracleJDK_started
        Infrastructure_configuring:
          target: Infrastructure
          activities:
            - set_state: configuring
          on_success:
            - Infrastructure_configured
        YorcOnDemandLocationResources_start:
          target: YorcOnDemandLocationResources
          activities:
            - call_operation: Standard.start
          on_success:
            - YorcOnDemandLocationResources_started
        OracleJDK_configuring:
          target: OracleJDK
          activities:
            - set_state: configuring
          on_success:
            - OracleJDK_configured
        YorcPlugin_start:
          target: YorcPlugin
          activities:
            - call_operation: Standard.start
          on_success:
            - YorcPlugin_started
        YorcServer_joinConsulAgentConsulAgentConsul_agent_pre_configure_source:
          target: YorcServer
          target_relationship: joinConsulAgentConsulAgentConsul_agent
          operation_host: SOURCE
          activities:
            - call_operation: Configure.pre_configure_source
          on_success:
            - YorcServer_configure
        Alien4Cloud_created:
          target: Alien4Cloud
          activities:
            - set_state: created
          on_success:
            - Alien4Cloud_configuring
        Infrastructure_started:
          target: Infrastructure
          activities:
            - set_state: started
        YorcPlugin_connectsToYorcYorcServerRest_pre_configure_source:
          target: YorcPlugin
          target_relationship: connectsToYorcYorcServerRest
          operation_host: SOURCE
          activities:
            - call_operation: Configure.pre_configure_source
          on_success:
            - YorcPlugin_configured
        TerraformRuntime_initial:
          target: TerraformRuntime
          activities:
            - set_state: initial
          on_success:
            - TerraformRuntime_creating
        YorcPlugin_starting:
          target: YorcPlugin
          activities:
            - set_state: starting
          on_success:
            - YorcPlugin_start
        Alien4Cloud_start:
          target: Alien4Cloud
          activities:
            - call_operation: Standard.start
          on_success:
            - Alien4Cloud_started
        ConsulServer_initial:
          target: ConsulServer
          activities:
            - set_state: initial
          on_success:
            - ConsulServer_creating
        Alien4CloudCompute_install:
          target: Alien4CloudCompute
          activities:
            - delegate: install
          on_success:
            - OracleJDK_initial
            - ConsulAgentA4C_initial
        OracleJDK_created:
          target: OracleJDK
          activities:
            - set_state: created
          on_success:
            - OracleJDK_configuring
        YorcServer_start:
          target: YorcServer
          activities:
            - call_operation: Standard.start
          on_success:
            - YorcServer_started
        Infrastructure_configured:
          target: Infrastructure
          activities:
            - set_state: configured
          on_success:
            - Infrastructure_starting
        NFSClient_started:
          target: NFSClient
          activities:
            - set_state: started
          on_success:
            - YorcServer_initial
        AnsibleRuntime_creating:
          target: AnsibleRuntime
          activities:
            - set_state: creating
          on_success:
            - AnsibleRuntime_create
        AnsibleRuntime_create:
          target: AnsibleRuntime
          activities:
            - call_operation: Standard.create
          on_success:
            - AnsibleRuntime_created
        ConsulAgentA4C_initial:
          target: ConsulAgentA4C
          activities:
            - set_state: initial
          on_success:
            - ConsulAgentA4C_creating
        Infrastructure_creating:
          target: Infrastructure
          activities:
            - set_state: creating
          on_success:
            - Infrastructure_created
        ConsulAgentA4C_started:
          target: ConsulAgentA4C
          activities:
            - set_state: started
        ConsulServer_started:
          target: ConsulServer
          activities:
            - set_state: started
          on_success:
            - ConsulAgentYorcServer_initial
            - ConsulAgentA4C_initial
        AnsibleRuntime_configured:
          target: AnsibleRuntime
          activities:
            - set_state: configured
          on_success:
            - AnsibleRuntime_starting
        Alien4Cloud_creating:
          target: Alien4Cloud
          activities:
            - set_state: creating
          on_success:
            - Alien4Cloud_create
        ConsulAgentYorcServer_creating:
          target: ConsulAgentYorcServer
          activities:
            - set_state: creating
          on_success:
            - ConsulAgentYorcServer_create
        Alien4Cloud_configure:
          target: Alien4Cloud
          activities:
            - call_operation: Standard.configure
          on_success:
            - Alien4Cloud_configured
        TerraformRuntime_starting:
          target: TerraformRuntime
          activities:
            - set_state: starting
          on_success:
            - TerraformRuntime_started
        Alien4Cloud_configured:
          target: Alien4Cloud
          activities:
            - set_state: configured
          on_success:
            - Alien4Cloud_starting
        NFSClient_creating:
          target: NFSClient
          activities:
            - set_state: creating
          on_success:
            - NFSClient_create
        NFSClient_start:
          target: NFSClient
          activities:
            - call_operation: Standard.start
          on_success:
            - NFSClient_started
        YorcServer_configured:
          target: YorcServer
          activities:
            - set_state: configured
          on_success:
            - YorcServer_starting
        YorcServer_starting:
          target: YorcServer
          activities:
            - set_state: starting
          on_success:
            - YorcServer_start
        ConsulAgentA4C_configure:
          target: ConsulAgentA4C
          activities:
            - call_operation: Standard.configure
          on_success:
            - ConsulAgentA4C_configured
        YorcPlugin_configured:
          target: YorcPlugin
          activities:
            - set_state: configured
          on_success:
            - YorcPlugin_starting
        AnsibleRuntime_created:
          target: AnsibleRuntime
          activities:
            - set_state: created
          on_success:
            - AnsibleRuntime_configuring
            - TerraformRuntime_initial
        YorcServer_configure:
          target: YorcServer
          activities:
            - call_operation: Standard.configure
          on_success:
            - YorcServer_dependsOnTerraformRuntimeTerraformRuntimeFeature_post_configure_source
        YorcPlugin_created:
          target: YorcPlugin
          activities:
            - set_state: created
          on_success:
            - YorcPlugin_configuring
        OracleJDK_create:
          target: OracleJDK
          activities:
            - call_operation: Standard.create
          on_success:
            - OracleJDK_created
        Infrastructure_initial:
          target: Infrastructure
          activities:
            - set_state: initial
          on_success:
            - Infrastructure_creating
        YorcPlugin_creating:
          target: YorcPlugin
          activities:
            - set_state: creating
          on_success:
            - YorcPlugin_created
        YorcOnDemandLocationResources_created:
          target: YorcOnDemandLocationResources
          activities:
            - set_state: created
          on_success:
            - YorcOnDemandLocationResources_configuring
        ConsulAgentA4C_joinServerConsulServerConsul_server_pre_configure_source:
          target: ConsulAgentA4C
          target_relationship: joinServerConsulServerConsul_server
          operation_host: SOURCE
          activities:
            - call_operation: Configure.pre_configure_source
          on_success:
            - ConsulAgentA4C_configure
        AnsibleRuntime_initial:
          target: AnsibleRuntime
          activities:
            - set_state: initial
          on_success:
            - AnsibleRuntime_creating
        NFSServer_create:
          target: NFSServer
          activities:
            - call_operation: Standard.create
          on_success:
            - NFSServer_created
        NFSClient_configured:
          target: NFSClient
          activities:
            - set_state: configured
          on_success:
            - NFSClient_starting
        TerraformRuntime_configuring:
          target: TerraformRuntime
          activities:
            - set_state: configuring
          on_success:
            - TerraformRuntime_configured
        TerraformRuntime_started:
          target: TerraformRuntime
          activities:
            - set_state: started
          on_success:
            - YorcServer_initial
        ConsulAgentYorcServer_started:
          target: ConsulAgentYorcServer
          activities:
            - set_state: started
          on_success:
            - YorcServer_initial
        NFSClient_joinNfsServerNfsServerNfs_server_pre_configure_source:
          target: NFSClient
          target_relationship: joinNfsServerNfsServerNfs_server
          operation_host: SOURCE
          activities:
            - call_operation: Configure.pre_configure_source
          on_success:
            - NFSClient_configured
        AnsibleRuntime_starting:
          target: AnsibleRuntime
          activities:
            - set_state: starting
          on_success:
            - AnsibleRuntime_started
        ConsulServer_configure:
          target: ConsulServer
          activities:
            - call_operation: Standard.configure
          on_success:
            - ConsulServer_configured
        Alien4Cloud_starting:
          target: Alien4Cloud
          activities:
            - set_state: starting
          on_success:
            - Alien4Cloud_start
        YorcServer_configuring:
          target: YorcServer
          activities:
            - set_state: configuring
          on_success:
            - YorcServer_joinConsulAgentConsulAgentConsul_agent_pre_configure_source
        OracleJDK_configured:
          target: OracleJDK
          activities:
            - set_state: configured
          on_success:
            - OracleJDK_starting
        YorcOnDemandLocationResources_starting:
          target: YorcOnDemandLocationResources
          activities:
            - set_state: starting
          on_success:
            - YorcOnDemandLocationResources_start
        ConsulAgentYorcServer_created:
          target: ConsulAgentYorcServer
          activities:
            - set_state: created
          on_success:
            - ConsulAgentYorcServer_configuring
            - AnsibleRuntime_initial
        TerraformRuntime_creating:
          target: TerraformRuntime
          activities:
            - set_state: creating
          on_success:
            - TerraformRuntime_create
        YorcServer_creating:
          target: YorcServer
          activities:
            - set_state: creating
          on_success:
            - YorcServer_create
        Alien4Cloud_initial:
          target: Alien4Cloud
          activities:
            - set_state: initial
          on_success:
            - Alien4Cloud_creating
        YorcOnDemandLocationResources_configuring:
          target: YorcOnDemandLocationResources
          activities:
            - set_state: configuring
          on_success:
            - YorcOnDemandLocationResources_configured
        ConsulAgentYorcServer_configured:
          target: ConsulAgentYorcServer
          activities:
            - set_state: configured
          on_success:
            - ConsulAgentYorcServer_starting
        TerraformRuntime_created:
          target: TerraformRuntime
          activities:
            - set_state: created
          on_success:
            - TerraformRuntime_configuring
        TerraformRuntime_configured:
          target: TerraformRuntime
          activities:
            - set_state: configured
          on_success:
            - TerraformRuntime_starting
        NFSClient_configuring:
          target: NFSClient
          activities:
            - set_state: configuring
          on_success:
            - NFSClient_joinNfsServerNfsServerNfs_server_pre_configure_source
        Infrastructure_created:
          target: Infrastructure
          activities:
            - set_state: created
          on_success:
            - Infrastructure_configuring
        ComputeConsul_install:
          target: ConsulCompute
          activities:
            - delegate: install
          on_success:
            - ConsulServer_initial
        NFSServer_configuring:
          target: NFSServer
          activities:
            - set_state: configuring
          on_success:
            - NFSServer_configured
        ConsulAgentYorcServer_configure:
          target: ConsulAgentYorcServer
          activities:
            - call_operation: Standard.configure
          on_success:
            - ConsulAgentYorcServer_configured
        ConsulAgentYorcServer_initial:
          target: ConsulAgentYorcServer
          activities:
            - set_state: initial
          on_success:
            - ConsulAgentYorcServer_creating
        ConsulServer_configuring:
          target: ConsulServer
          activities:
            - set_state: configuring
          on_success:
            - ConsulServer_configure
        AnsibleRuntime_started:
          target: AnsibleRuntime
          activities:
            - set_state: started
          on_success:
            - YorcServer_initial
        Alien4Cloud_create:
          target: Alien4Cloud
          activities:
            - call_operation: Standard.create
          on_success:
            - Alien4Cloud_created
        NFSClient_create:
          target: NFSClient
          activities:
            - call_operation: Standard.create
          on_success:
            - NFSClient_created
        ConsulServer_creating:
          target: ConsulServer
          activities:
            - set_state: creating
          on_success:
            - ConsulServer_create
        ConsulAgentA4C_created:
          target: ConsulAgentA4C
          activities:
            - set_state: created
          on_success:
            - ConsulAgentA4C_configuring
        YorcPlugin_started:
          target: YorcPlugin
          activities:
            - set_state: started
          on_success:
            - YorcOnDemandLocationResources_initial
        NFSServer_initial:
          target: NFSServer
          activities:
            - set_state: initial
          on_success:
            - NFSServer_creating
        YorcPlugin_initial:
          target: YorcPlugin
          activities:
            - set_state: initial
          on_success:
            - YorcPlugin_creating
        ConsulAgentA4C_creating:
          target: ConsulAgentA4C
          activities:
            - set_state: creating
          on_success:
            - ConsulAgentA4C_create
        NFSServer_started:
          target: NFSServer
          activities:
            - set_state: started
          on_success:
            - NFSClient_initial
        TerraformRuntime_create:
          target: TerraformRuntime
          activities:
            - call_operation: Standard.create
          on_success:
            - TerraformRuntime_created
        ConsulServer_start:
          target: ConsulServer
          activities:
            - call_operation: Standard.start
          on_success:
            - ConsulServer_started
        YorcOnDemandLocationResources_creating:
          target: YorcOnDemandLocationResources
          activities:
            - set_state: creating
          on_success:
            - YorcOnDemandLocationResources_create
        Infrastructure_yorcConfigInfrastructureHostedOnYorcYorcServerConfig_post_configure_target:
          target: Infrastructure
          target_relationship: infraHostedOnYorcServer
          operation_host: TARGET
          activities:
            - call_operation: Configure.post_configure_target
          on_success:
            - YorcServer_configured
        YorcOnDemandLocationResources_initial:
          target: YorcOnDemandLocationResources
          activities:
            - set_state: initial
          on_success:
            - YorcOnDemandLocationResources_creating
        YorcOnDemandLocationResources_configured:
          target: YorcOnDemandLocationResources
          activities:
            - set_state: configured
          on_success:
            - YorcOnDemandLocationResources_starting
        YorcOnDemandLocationResources_started:
          target: YorcOnDemandLocationResources
          activities:
            - set_state: started
        ConsulAgentYorcServer_joinServerConsulServerConsul_server_pre_configure_source:
          target: ConsulAgentYorcServer
          target_relationship: joinServerConsulServerConsul_server
          operation_host: SOURCE
          activities:
            - call_operation: Configure.pre_configure_source
          on_success:
            - ConsulAgentYorcServer_configure
        ConsulAgentYorcServer_configuring:
          target: ConsulAgentYorcServer
          activities:
            - set_state: configuring
          on_success:
            - ConsulAgentYorcServer_joinServerConsulServerConsul_server_pre_configure_source
        YorcServer_create:
          target: YorcServer
          activities:
            - call_operation: Standard.create
          on_success:
            - YorcServer_created
        OracleJDK_initial:
          target: OracleJDK
          activities:
            - set_state: initial
          on_success:
            - OracleJDK_creating
        ConsulAgentA4C_configuring:
          target: ConsulAgentA4C
          activities:
            - set_state: configuring
          on_success:
            - ConsulAgentA4C_joinServerConsulServerConsul_server_pre_configure_source
        OracleJDK_started:
          target: OracleJDK
          activities:
            - set_state: started
          on_success:
            - Alien4Cloud_initial
        NFSServer_creating:
          target: NFSServer
          activities:
            - set_state: creating
          on_success:
            - NFSServer_create
    uninstall:
      steps:
        ComputeAddress_uninstall:
          target: ComputeAddress
          activities:
            - delegate: uninstall
        TerraformRuntime_delete:
          target: TerraformRuntime
          activities:
            - call_operation: Standard.delete
          on_success:
            - TerraformRuntime_deleted
        YorcServer_stopping:
          target: YorcServer
          activities:
            - set_state: stopping
          on_success:
            - YorcServer_stop
        OracleJDK_stopped:
          target: OracleJDK
          activities:
            - set_state: stopped
          on_success:
            - OracleJDK_deleting
        OracleJDK_stopping:
          target: OracleJDK
          activities:
            - set_state: stopping
          on_success:
            - OracleJDK_stopped
        ConsulAgentYorcServer_deleted:
          target: ConsulAgentYorcServer
          activities:
            - set_state: deleted
          on_success:
            - ConsulServer_stopping
            - ComputeYorc_uninstall
        Infrastructure_stopped:
          target: Infrastructure
          activities:
            - set_state: stopped
          on_success:
            - Infrastructure_deleting
        ConsulServer_stop:
          target: ConsulServer
          activities:
            - call_operation: Standard.stop
          on_success:
            - ConsulServer_stopped
        YorcPlugin_stopping:
          target: YorcPlugin
          activities:
            - set_state: stopping
          on_success:
            - YorcPlugin_stopped
        YorcOnDemandLocationResources_deleted:
          target: YorcOnDemandLocationResources
          activities:
            - set_state: deleted
          on_success:
            - YorcPlugin_stopping
        Alien4Cloud_stopped:
          target: Alien4Cloud
          activities:
            - set_state: stopped
          on_success:
            - Alien4Cloud_deleting
        YorcOnDemandLocationResources_stopped:
          target: YorcOnDemandLocationResources
          activities:
            - set_state: stopped
          on_success:
            - YorcOnDemandLocationResources_deleting
        Alien4CloudCompute_uninstall:
          target: Alien4CloudCompute
          activities:
            - delegate: uninstall
          {{if .Address}}
          on_success:
            - ComputeAddress_uninstall
          {{end}}
        ComputeYorc_uninstall:
          target: YorcCompute
          activities:
            - delegate: uninstall
        TerraformRuntime_deleted:
          target: TerraformRuntime
          activities:
            - set_state: deleted
          on_success:
            - ComputeYorc_uninstall
        ConsulAgentA4C_deleted:
          target: ConsulAgentA4C
          activities:
            - set_state: deleted
          on_success:
            - ConsulServer_stopping
            - Alien4CloudCompute_uninstall
        YorcPlugin_stopped:
          target: YorcPlugin
          activities:
            - set_state: stopped
          on_success:
            - YorcPlugin_deleting
        NFSServer_deleting:
          target: NFSServer
          activities:
            - set_state: deleting
          on_success:
            - NFSServer_deleted
        AnsibleRuntime_stopped:
          target: AnsibleRuntime
          activities:
            - set_state: stopped
          on_success:
            - AnsibleRuntime_deleting
        Infrastructure_stopping:
          target: Infrastructure
          activities:
            - set_state: stopping
          on_success:
            - Infrastructure_stopped
        YorcOnDemandLocationResources_deleting:
          target: YorcOnDemandLocationResources
          activities:
            - set_state: deleting
          on_success:
            - YorcOnDemandLocationResources_deleted
        Alien4Cloud_stopping:
          target: Alien4Cloud
          activities:
            - set_state: stopping
          on_success:
            - Alien4Cloud_stopped
        ConsulAgentYorcServer_stopping:
          target: ConsulAgentYorcServer
          activities:
            - set_state: stopping
          on_success:
            - ConsulAgentYorcServer_stop
        AnsibleRuntime_stopping:
          target: AnsibleRuntime
          activities:
            - set_state: stopping
          on_success:
            - AnsibleRuntime_stopped
        ConsulAgentA4C_stopping:
          target: ConsulAgentA4C
          activities:
            - set_state: stopping
          on_success:
            - ConsulAgentA4C_stop
        NFSClient_deleting:
          target: NFSClient
          activities:
            - set_state: deleting
          on_success:
            - NFSClient_deleted
        NFSClient_stop:
          target: NFSClient
          activities:
            - call_operation: Standard.stop
          on_success:
            - NFSClient_stopped
        ComputeNFS_uninstall:
          target: NFSCompute
          activities:
            - delegate: uninstall
        ConsulAgentYorcServer_stop:
          target: ConsulAgentYorcServer
          activities:
            - call_operation: Standard.stop
          on_success:
            - ConsulAgentYorcServer_stopped
        YorcServer_deleted:
          target: YorcServer
          activities:
            - set_state: deleted
          on_success:
            - TerraformRuntime_stopping
            - ConsulAgentYorcServer_stopping
            - AnsibleRuntime_stopping
            - NFSClient_stopping
            - ComputeYorc_uninstall
        ConsulAgentYorcServer_deleting:
          target: ConsulAgentYorcServer
          activities:
            - set_state: deleting
          on_success:
            - ConsulAgentYorcServer_deleted
        Infrastructure_deleting:
          target: Infrastructure
          activities:
            - set_state: deleting
          on_success:
            - Infrastructure_deleted
        ConsulServer_deleting:
          target: ConsulServer
          activities:
            - set_state: deleting
          on_success:
            - ConsulServer_deleted
        NFSServer_stopping:
          target: NFSServer
          activities:
            - set_state: stopping
          on_success:
            - NFSServer_stop
        AnsibleRuntime_deleting:
          target: AnsibleRuntime
          activities:
            - set_state: deleting
          on_success:
            - AnsibleRuntime_delete
        NFSClient_stopping:
          target: NFSClient
          activities:
            - set_state: stopping
          on_success:
            - NFSClient_stop
        Infrastructure_deleted:
          target: Infrastructure
          activities:
            - set_state: deleted
          on_success:
            - YorcServer_stopping
        OracleJDK_deleted:
          target: OracleJDK
          activities:
            - set_state: deleted
          on_success:
            - Alien4CloudCompute_uninstall
        YorcServer_stopped:
          target: YorcServer
          activities:
            - set_state: stopped
          on_success:
            - YorcServer_deleting
        NFSClient_deleted:
          target: NFSClient
          activities:
            - set_state: deleted
          on_success:
            - NFSServer_stopping
            - ComputeYorc_uninstall
        OracleJDK_deleting:
          target: OracleJDK
          activities:
            - set_state: deleting
          on_success:
            - OracleJDK_deleted
        AnsibleRuntime_delete:
          target: AnsibleRuntime
          activities:
            - call_operation: Standard.delete
          on_success:
            - AnsibleRuntime_deleted
        YorcServer_deleting:
          target: YorcServer
          activities:
            - set_state: deleting
          on_success:
            - YorcServer_delete
        Alien4Cloud_deleted:
          target: Alien4Cloud
          activities:
            - set_state: deleted
          on_success:
            - OracleJDK_stopping
        TerraformRuntime_stopped:
          target: TerraformRuntime
          activities:
            - set_state: stopped
          on_success:
            - TerraformRuntime_deleting
        YorcServer_stop:
          target: YorcServer
          activities:
            - call_operation: Standard.stop
          on_success:
            - YorcServer_stopped
        YorcServer_delete:
          target: YorcServer
          activities:
            - call_operation: Standard.delete
          on_success:
            - YorcServer_deleted
        YorcOnDemandLocationResources_stopping:
          target: YorcOnDemandLocationResources
          activities:
            - set_state: stopping
          on_success:
            - YorcOnDemandLocationResources_stopped
        YorcPlugin_deleted:
          target: YorcPlugin
          activities:
            - set_state: deleted
          on_success:
            - Alien4Cloud_stopping
            - YorcServer_stopping
        ConsulAgentYorcServer_stopped:
          target: ConsulAgentYorcServer
          activities:
            - set_state: stopped
          on_success:
            - ConsulAgentYorcServer_deleting
        AnsibleRuntime_deleted:
          target: AnsibleRuntime
          activities:
            - set_state: deleted
          on_success:
            - ComputeYorc_uninstall
        ConsulServer_stopping:
          target: ConsulServer
          activities:
            - set_state: stopping
          on_success:
            - ConsulServer_stop
        ConsulAgentA4C_stopped:
          target: ConsulAgentA4C
          activities:
            - set_state: stopped
          on_success:
            - ConsulAgentA4C_deleting
        NFSServer_deleted:
          target: NFSServer
          activities:
            - set_state: deleted
          on_success:
            - ComputeNFS_uninstall
        NFSServer_stop:
          target: NFSServer
          activities:
            - call_operation: Standard.stop
          on_success:
            - NFSServer_stopped
        ConsulAgentA4C_deleting:
          target: ConsulAgentA4C
          activities:
            - set_state: deleting
          on_success:
            - ConsulAgentA4C_deleted
        NFSClient_stopped:
          target: NFSClient
          activities:
            - set_state: stopped
          on_success:
            - NFSClient_deleting
        NFSServer_stopped:
          target: NFSServer
          activities:
            - set_state: stopped
          on_success:
            - NFSServer_deleting
        TerraformRuntime_deleting:
          target: TerraformRuntime
          activities:
            - set_state: deleting
          on_success:
            - TerraformRuntime_delete
        ComputeConsul_uninstall:
          target: ConsulCompute
          activities:
            - delegate: uninstall
        {{if .Address}}
        ComputeAddress_uninstall:
          target: ComputeAddress
          activities:
            - delegate: uninstall
        {{end}}
        Alien4Cloud_deleting:
          target: Alien4Cloud
          activities:
            - set_state: deleting
          on_success:
            - Alien4Cloud_deleted
        ConsulServer_stopped:
          target: ConsulServer
          activities:
            - set_state: stopped
          on_success:
            - ConsulServer_deleting
        ConsulServer_deleted:
          target: ConsulServer
          activities:
            - set_state: deleted
          on_success:
            - ComputeConsul_uninstall
        YorcPlugin_deleting:
          target: YorcPlugin
          activities:
            - set_state: deleting
          on_success:
            - YorcPlugin_deleted
        TerraformRuntime_stopping:
          target: TerraformRuntime
          activities:
            - set_state: stopping
          on_success:
            - TerraformRuntime_stopped
        ConsulAgentA4C_stop:
          target: ConsulAgentA4C
          activities:
            - call_operation: Standard.stop
          on_success:
            - ConsulAgentA4C_stopped
    start:
      steps:
        Alien4Cloud_started:
          target: Alien4Cloud
          activities:
            - set_state: started
          on_success:
            - YorcPlugin_starting
        ConsulAgentYorcServer_start:
          target: ConsulAgentYorcServer
          activities:
            - call_operation: Standard.start
          on_success:
            - ConsulAgentYorcServer_started
        OracleJDK_starting:
          target: OracleJDK
          activities:
            - set_state: starting
          on_success:
            - OracleJDK_started
        YorcOnDemandLocationResources_start:
          target: YorcOnDemandLocationResources
          activities:
            - call_operation: Standard.start
          on_success:
            - YorcOnDemandLocationResources_started
        YorcPlugin_start:
          target: YorcPlugin
          activities:
            - call_operation: Standard.start
          on_success:
            - YorcPlugin_started
        ComputeYorc_start:
          target: YorcCompute
          activities:
            - delegate: start
          on_success:
            - TerraformRuntime_starting
            - ConsulAgentYorcServer_starting
            - NFSClient_starting
            - AnsibleRuntime_starting
            - YorcServer_starting
        ComputeNFS_start:
          target: NFSCompute
          activities:
            - delegate: start
          on_success:
            - NFSServer_starting
        Alien4CloudCompute_start:
          target: Alien4CloudCompute
          activities:
            - delegate: start
          on_success:
            - OracleJDK_starting
            - ConsulAgentA4C_starting
        Infrastructure_started:
          target: Infrastructure
          activities:
            - set_state: started
        YorcPlugin_starting:
          target: YorcPlugin
          activities:
            - set_state: starting
          on_success:
            - YorcPlugin_start
        Alien4Cloud_start:
          target: Alien4Cloud
          activities:
            - call_operation: Standard.start
          on_success:
            - Alien4Cloud_started
        AnsibleRuntime_started:
          target: AnsibleRuntime
          activities:
            - set_state: started
          on_success:
            - YorcServer_starting
        YorcServer_start:
          target: YorcServer
          activities:
            - call_operation: Standard.start
          on_success:
            - YorcServer_started
        TerraformRuntime_started:
          target: TerraformRuntime
          activities:
            - set_state: started
          on_success:
            - YorcServer_starting
        NFSClient_started:
          target: NFSClient
          activities:
            - set_state: started
          on_success:
            - YorcServer_starting
        ComputeConsul_start:
          target: ConsulCompute
          activities:
            - delegate: start
          on_success:
            - ConsulServer_starting
        ConsulServer_starting:
          target: ConsulServer
          activities:
            - set_state: starting
          on_success:
            - ConsulServer_start
        ConsulAgentYorcServer_started:
          target: ConsulAgentYorcServer
          activities:
            - set_state: started
          on_success:
            - YorcServer_starting
        NFSServer_starting:
          target: NFSServer
          activities:
            - set_state: starting
          on_success:
            - NFSServer_started
        YorcPlugin_started:
          target: YorcPlugin
          activities:
            - set_state: started
          on_success:
            - YorcOnDemandLocationResources_starting
        ConsulAgentA4C_starting:
          target: ConsulAgentA4C
          activities:
            - set_state: starting
          on_success:
            - ConsulAgentA4C_start
        AnsibleRuntime_starting:
          target: AnsibleRuntime
          activities:
            - set_state: starting
          on_success:
            - AnsibleRuntime_started
        ConsulAgentA4C_started:
          target: ConsulAgentA4C
          activities:
            - set_state: started
        ConsulServer_started:
          target: ConsulServer
          activities:
            - set_state: started
          on_success:
            - ConsulAgentYorcServer_starting
            - ConsulAgentA4C_starting
        Infrastructure_starting:
          target: Infrastructure
          activities:
            - set_state: starting
          on_success:
        {{if not .Hosts}}
            - Infrastructure_started
        {{else}}
            - Infrastructure_start
		    {{end}}
        {{if .Hosts}}
        Infrastructure_start:
          target: Infrastructure
          activities:
            - call_operation: Standard.start
          on_success:
            - Infrastructure_started
		    {{end}}
        ConsulAgentYorcServer_starting:
          target: ConsulAgentYorcServer
          activities:
            - set_state: starting
          on_success:
            - ConsulAgentYorcServer_start
        Alien4Cloud_starting:
          target: Alien4Cloud
          activities:
            - set_state: starting
          on_success:
            - Alien4Cloud_start
        YorcOnDemandLocationResources_starting:
          target: YorcOnDemandLocationResources
          activities:
            - set_state: starting
          on_success:
            - YorcOnDemandLocationResources_start
        YorcOnDemandLocationResources_started:
          target: YorcOnDemandLocationResources
          activities:
            - set_state: started
        NFSServer_started:
          target: NFSServer
          activities:
            - set_state: started
          on_success:
            - NFSClient_starting
        {{if .Address}}
        ComputeAddress_start:
          target: ComputeAddress
          activities:
            - delegate: start
          on_success:
            - Alien4CloudCompute_start
        {{end}}
        ConsulServer_start:
          target: ConsulServer
          activities:
            - call_operation: Standard.start
          on_success:
            - ConsulServer_started
        TerraformRuntime_starting:
          target: TerraformRuntime
          activities:
            - set_state: starting
          on_success:
            - TerraformRuntime_started
        NFSClient_start:
          target: NFSClient
          activities:
            - call_operation: Standard.start
          on_success:
            - NFSClient_started
        NFSClient_starting:
          target: NFSClient
          activities:
            - set_state: starting
          on_success:
            - NFSClient_start
        YorcServer_starting:
          target: YorcServer
          activities:
            - set_state: starting
          on_success:
            - YorcServer_start
        ConsulAgentA4C_start:
          target: ConsulAgentA4C
          activities:
            - call_operation: Standard.start
          on_success:
            - ConsulAgentA4C_started
        YorcServer_started:
          target: YorcServer
          activities:
            - set_state: started
          on_success:
            - YorcPlugin_starting
            - Infrastructure_starting
        OracleJDK_started:
          target: OracleJDK
          activities:
            - set_state: started
          on_success:
            - Alien4Cloud_starting
    stop:
      steps:
        YorcServer_stopping:
          target: YorcServer
          activities:
            - set_state: stopping
          on_success:
            - YorcServer_stop
        OracleJDK_stopped:
          target: OracleJDK
          activities:
            - set_state: stopped
          on_success:
            - Alien4CloudCompute_stop
        OracleJDK_stopping:
          target: OracleJDK
          activities:
            - set_state: stopping
          on_success:
            - OracleJDK_stopped
        ComputeYorc_stop:
          target: YorcCompute
          activities:
            - delegate: stop
        Infrastructure_stopped:
          target: Infrastructure
          activities:
            - set_state: stopped
          on_success:
            - YorcServer_stopping
        ConsulServer_stop:
          target: ConsulServer
          activities:
            - call_operation: Standard.stop
          on_success:
            - ConsulServer_stopped
        YorcPlugin_stopping:
          target: YorcPlugin
          activities:
            - set_state: stopping
          on_success:
            - YorcPlugin_stopped
        YorcServer_stopped:
          target: YorcServer
          activities:
            - set_state: stopped
          on_success:
            - TerraformRuntime_stopping
            - ComputeYorc_stop
            - ConsulAgentYorcServer_stopping
            - AnsibleRuntime_stopping
            - NFSClient_stopping
        Alien4Cloud_stopped:
          target: Alien4Cloud
          activities:
            - set_state: stopped
          on_success:
            - OracleJDK_stopping
        YorcOnDemandLocationResources_stopped:
          target: YorcOnDemandLocationResources
          activities:
            - set_state: stopped
          on_success:
            - YorcPlugin_stopping
        TerraformRuntime_stopped:
          target: TerraformRuntime
          activities:
            - set_state: stopped
          on_success:
            - ComputeYorc_stop
        YorcServer_stop:
          target: YorcServer
          activities:
            - call_operation: Standard.stop
          on_success:
            - YorcServer_stopped
        ConsulAgentYorcServer_stopped:
          target: ConsulAgentYorcServer
          activities:
            - set_state: stopped
          on_success:
            - ComputeYorc_stop
            - ConsulServer_stopping
        ComputeNFS_stop:
          target: NFSCompute
          activities:
            - delegate: stop
        YorcOnDemandLocationResources_stopping:
          target: YorcOnDemandLocationResources
          activities:
            - set_state: stopping
          on_success:
            - YorcOnDemandLocationResources_stopped
        YorcPlugin_stopped:
          target: YorcPlugin
          activities:
            - set_state: stopped
          on_success:
            - Alien4Cloud_stopping
            - YorcServer_stopping
        ComputeConsul_stop:
          target: ConsulCompute
          activities:
            - delegate: stop
        AnsibleRuntime_stopped:
          target: AnsibleRuntime
          activities:
            - set_state: stopped
          on_success:
            - ComputeYorc_stop
        ConsulServer_stopping:
          target: ConsulServer
          activities:
            - set_state: stopping
          on_success:
            - ConsulServer_stop
        ConsulAgentA4C_stopped:
          target: ConsulAgentA4C
          activities:
            - set_state: stopped
          on_success:
            - ConsulServer_stopping
            - Alien4CloudCompute_stop
        Infrastructure_stopping:
          target: Infrastructure
          activities:
            - set_state: stopping
          on_success:
            - Infrastructure_stopped
        Alien4Cloud_stopping:
          target: Alien4Cloud
          activities:
            - set_state: stopping
          on_success:
            - Alien4Cloud_stopped
        ConsulAgentYorcServer_stopping:
          target: ConsulAgentYorcServer
          activities:
            - set_state: stopping
          on_success:
            - ConsulAgentYorcServer_stop
        AnsibleRuntime_stopping:
          target: AnsibleRuntime
          activities:
            - set_state: stopping
          on_success:
            - AnsibleRuntime_stopped
        ConsulAgentA4C_stopping:
          target: ConsulAgentA4C
          activities:
            - set_state: stopping
          on_success:
            - ConsulAgentA4C_stop
        NFSServer_stop:
          target: NFSServer
          activities:
            - call_operation: Standard.stop
          on_success:
            - NFSServer_stopped
        {{if .Address}}
        ComputeAddress_stop:
          target: ComputeAddress
          activities:
            - delegate: stop
        {{end}}
        NFSClient_stopped:
          target: NFSClient
          activities:
            - set_state: stopped
          on_success:
            - NFSServer_stopping
            - ComputeYorc_stop
        NFSClient_stop:
          target: NFSClient
          activities:
            - call_operation: Standard.stop
          on_success:
            - NFSClient_stopped
        NFSServer_stopped:
          target: NFSServer
          activities:
            - set_state: stopped
          on_success:
            - ComputeNFS_stop
        ConsulAgentYorcServer_stop:
          target: ConsulAgentYorcServer
          activities:
            - call_operation: Standard.stop
          on_success:
            - ConsulAgentYorcServer_stopped
        ConsulServer_stopped:
          target: ConsulServer
          activities:
            - set_state: stopped
          on_success:
            - ComputeConsul_stop
        Alien4CloudCompute_stop:
          target: Alien4CloudCompute
          activities:
            - delegate: stop
          {{if .Address}}
          on_success:
            - ComputeAddress_stop
          {{end}}
        TerraformRuntime_stopping:
          target: TerraformRuntime
          activities:
            - set_state: stopping
          on_success:
            - TerraformRuntime_stopped
        NFSServer_stopping:
          target: NFSServer
          activities:
            - set_state: stopping
          on_success:
            - NFSServer_stop
        ConsulAgentA4C_stop:
          target: ConsulAgentA4C
          activities:
            - call_operation: Standard.stop
          on_success:
            - ConsulAgentA4C_stopped
        NFSClient_stopping:
          target: NFSClient
          activities:
            - set_state: stopping
          on_success:
            - NFSClient_stop
    run:
      steps:
        ConsulAgentYorcServer_submitted:
          target: ConsulAgentYorcServer
          activities:
            - set_state: submitted
          on_success:
            - ConsulAgentYorcServer_executed
        YorcServer_submitted:
          target: YorcServer
          activities:
            - set_state: submitted
          on_success:
            - YorcServer_executed
        NFSClient_submitted:
          target: NFSClient
          activities:
            - set_state: submitted
          on_success:
            - NFSClient_executed
        YorcPlugin_submitted:
          target: YorcPlugin
          activities:
            - set_state: submitted
          on_success:
            - YorcPlugin_executed
        ConsulAgentA4C_submitted:
          target: ConsulAgentA4C
          activities:
            - set_state: submitted
          on_success:
            - ConsulAgentA4C_executed
        YorcOnDemandLocationResources_executed:
          target: YorcOnDemandLocationResources
          activities:
            - set_state: executed
        Alien4Cloud_submitted:
          target: Alien4Cloud
          activities:
            - set_state: submitted
          on_success:
            - Alien4Cloud_executed
        OracleJDK_executed:
          target: OracleJDK
          activities:
            - set_state: executed
          on_success:
            - Alien4Cloud_submitted
        NFSClient_executed:
          target: NFSClient
          activities:
            - set_state: executed
          on_success:
            - YorcServer_submitted
        YorcOnDemandLocationResources_submitted:
          target: YorcOnDemandLocationResources
          activities:
            - set_state: submitted
          on_success:
            - YorcOnDemandLocationResources_executed
        OracleJDK_submitted:
          target: OracleJDK
          activities:
            - set_state: submitted
          on_success:
            - OracleJDK_executed
        ConsulAgentA4C_executed:
          target: ConsulAgentA4C
          activities:
            - set_state: executed
        NFSServer_executed:
          target: NFSServer
          activities:
            - set_state: executed
          on_success:
            - NFSClient_submitted
        ConsulServer_executed:
          target: ConsulServer
          activities:
            - set_state: executed
          on_success:
            - ConsulAgentYorcServer_submitted
            - ConsulAgentA4C_submitted
        Infrastructure_submitted:
          target: Infrastructure
          activities:
            - set_state: submitted
          on_success:
            - Infrastructure_executed
        NFSServer_submitted:
          target: NFSServer
          activities:
            - set_state: submitted
          on_success:
            - NFSServer_executed
        YorcServer_executed:
          target: YorcServer
          activities:
            - set_state: executed
          on_success:
            - Infrastructure_submitted
            - YorcPlugin_submitted
        TerraformRuntime_executed:
          target: TerraformRuntime
          activities:
            - set_state: executed
          on_success:
            - YorcServer_submitted
        Alien4Cloud_executed:
          target: Alien4Cloud
          activities:
            - set_state: executed
          on_success:
            - YorcPlugin_submitted
        TerraformRuntime_submitted:
          target: TerraformRuntime
          activities:
            - set_state: submitted
          on_success:
            - TerraformRuntime_executed
        AnsibleRuntime_executed:
          target: AnsibleRuntime
          activities:
            - set_state: executed
          on_success:
            - YorcServer_submitted
        ConsulAgentYorcServer_executed:
          target: ConsulAgentYorcServer
          activities:
            - set_state: executed
          on_success:
            - YorcServer_submitted
        Infrastructure_executed:
          target: Infrastructure
          activities:
            - set_state: executed
        AnsibleRuntime_submitted:
          target: AnsibleRuntime
          activities:
            - set_state: submitted
          on_success:
            - AnsibleRuntime_executed
        YorcPlugin_executed:
          target: YorcPlugin
          activities:
            - set_state: executed
          on_success:
            - YorcOnDemandLocationResources_submitted
        ConsulServer_submitted:
          target: ConsulServer
          activities:
            - set_state: submitted
          on_success:
            - ConsulServer_executed
